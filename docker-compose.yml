services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: filemgr-backend
    env_file:
      - ./backend/.env
    volumes:
      - ./backend/serviceAccount.json:/secrets/serviceAccount.json:ro
    environment:
      - PORT=8080
      - GOOGLE_APPLICATION_CREDENTIALS=/secrets/serviceAccount.json
    ports:
      - "8001:8080"
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        # since backend is mapped to host 8001
        VITE_API_BASE_URL: "http://localhost:8001"

        # IMPORTANT: pass Firebase VITE_* at build time
        VITE_FIREBASE_API_KEY: "${VITE_FIREBASE_API_KEY}"
        VITE_FIREBASE_AUTH_DOMAIN: "${VITE_FIREBASE_AUTH_DOMAIN}"
        VITE_FIREBASE_PROJECT_ID: "${VITE_FIREBASE_PROJECT_ID}"
        VITE_FIREBASE_APP_ID: "${VITE_FIREBASE_APP_ID}"

        # Optional (only if you use them)
        VITE_FIREBASE_STORAGE_BUCKET: "${VITE_FIREBASE_STORAGE_BUCKET}"
        VITE_FIREBASE_MESSAGING_SENDER_ID: "${VITE_FIREBASE_MESSAGING_SENDER_ID}"
        VITE_FIREBASE_MEASUREMENT_ID: "${VITE_FIREBASE_MEASUREMENT_ID}"

    container_name: filemgr-frontend
    ports:
      - "5174:80"
    depends_on:
      - backend
    restart: unless-stopped

  prometheus:
    image: prom/prometheus
    container_name: filemgr-prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
    ports:
      - "9090:9090"
    depends_on:
      - backend
    restart: unless-stopped
